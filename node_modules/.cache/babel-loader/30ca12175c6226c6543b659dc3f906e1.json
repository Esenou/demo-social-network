{"ast":null,"code":"import _regeneratorRuntime from\"/home/esen/my-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/esen/my-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/home/esen/my-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/home/esen/my-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{usersAPI}from\"../api/api\";import{updateObjectInArray}from\"../utils/object-helpers\";var FOLLOW='FOLLOW';var UNFOLLOW='UNFOLLOW';var SET_USERS='SET-USERS';var SET_CURRENT_PAGE='SET_CURRENT_PAGE';var SET_TOTAL_USERS_COUNT='SET_TOTAL_USERS_COUNT';var TOGGLE_IS_FETHING='TOGGLE_IS_FETHING';var TOGGLE_IS_FOLLOWING_PROGRESS='TOGGLE_IS_FOLLOWING_PROGRESS';var initialState={users:[],pageSize:100,totalUserCount:0,currentPage:4,isFetching:true,followingInProgress:[2,1]};var UsersReducer=function UsersReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case FOLLOW:{return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userId,\"id\",{followed:true})});}case UNFOLLOW:{return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userId,\"id\",{followed:false})});}case SET_USERS:{return _objectSpread(_objectSpread({},state),{},{users:action.users});}case SET_CURRENT_PAGE:{return _objectSpread(_objectSpread({},state),{},{currentPage:action.currentPage});}case SET_TOTAL_USERS_COUNT:{return _objectSpread(_objectSpread({},state),{},{totalUserCount:action.totalUsersCount});}case TOGGLE_IS_FETHING:{return _objectSpread(_objectSpread({},state),{},{isFetching:action.isFetching});}case TOGGLE_IS_FOLLOWING_PROGRESS:{return _objectSpread(_objectSpread({},state),{},{followingInProgress:action.isFetching?[].concat(_toConsumableArray(state.followingInProgress),[action.userId]):state.followingInProgress.filter(function(id){return id!=action.userId;})});}default:return state;}};export var followSuccess=function followSuccess(userId){return{type:FOLLOW,userId:userId};};export var unfollowSuccess=function unfollowSuccess(userId){return{type:UNFOLLOW,userId:userId};};export var setUsers=function setUsers(users){return{type:SET_USERS,users:users};};export var setCurrentPage=function setCurrentPage(currentPage){return{type:SET_CURRENT_PAGE,currentPage:currentPage};};export var setTotalUsersCount=function setTotalUsersCount(totalUsersCount){return{type:SET_TOTAL_USERS_COUNT,totalUsersCount:totalUsersCount};};export var toggleIsFetching=function toggleIsFetching(isFetching){return{type:TOGGLE_IS_FETHING,isFetching:isFetching};};export var toggleFollowingProgress=function toggleFollowingProgress(isFetching,userId){return{type:TOGGLE_IS_FOLLOWING_PROGRESS,isFetching:isFetching,userId:userId};};export var requestUsers=function requestUsers(currentPage,pageSize){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch(toggleIsFetching(true));_context.next=3;return usersAPI.getUsers(currentPage,pageSize);case 3:data=_context.sent;dispatch(toggleIsFetching(false));dispatch(setUsers(data.items));dispatch(setTotalUsersCount(data.totalCount));case 7:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};var followUnfollowFlow=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch,userId,apiMethod,actionCreator){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dispatch(toggleFollowingProgress(true,userId));_context2.next=3;return apiMethod(userId);case 3:response=_context2.sent;if(response.data.resultCode===0){dispatch(followSuccess(userId));}dispatch(toggleFollowingProgress(false,userId));case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function followUnfollowFlow(_x2,_x3,_x4,_x5){return _ref2.apply(this,arguments);};}();export var follow=function follow(userId){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var apiMethod;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:apiMethod=usersAPI.follow.bind(usersAPI);followUnfollowFlow(dispatch,userId,apiMethod,followSuccess);case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x6){return _ref3.apply(this,arguments);};}();};export var unfollow=function unfollow(userId){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){var apiMethod;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:apiMethod=usersAPI.unfollow.bind(usersAPI);followUnfollowFlow(dispatch,userId,apiMethod,unfollowSuccess);case 2:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x7){return _ref4.apply(this,arguments);};}();};export default UsersReducer;","map":{"version":3,"sources":["/home/esen/my-app/src/redux/users-reducer.js"],"names":["usersAPI","updateObjectInArray","FOLLOW","UNFOLLOW","SET_USERS","SET_CURRENT_PAGE","SET_TOTAL_USERS_COUNT","TOGGLE_IS_FETHING","TOGGLE_IS_FOLLOWING_PROGRESS","initialState","users","pageSize","totalUserCount","currentPage","isFetching","followingInProgress","UsersReducer","state","action","type","userId","followed","totalUsersCount","filter","id","followSuccess","unfollowSuccess","setUsers","setCurrentPage","setTotalUsersCount","toggleIsFetching","toggleFollowingProgress","requestUsers","dispatch","getUsers","data","items","totalCount","followUnfollowFlow","apiMethod","actionCreator","response","resultCode","follow","bind","unfollow"],"mappings":"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","sourcesContent":["import { usersAPI } from \"../api/api\";\nimport { updateObjectInArray } from \"../utils/object-helpers\";\n\nconst FOLLOW = 'FOLLOW';\nconst UNFOLLOW = 'UNFOLLOW';\nconst SET_USERS = 'SET-USERS';\nconst SET_CURRENT_PAGE = 'SET_CURRENT_PAGE';\nconst SET_TOTAL_USERS_COUNT = 'SET_TOTAL_USERS_COUNT';\nconst TOGGLE_IS_FETHING = 'TOGGLE_IS_FETHING';\nconst TOGGLE_IS_FOLLOWING_PROGRESS = 'TOGGLE_IS_FOLLOWING_PROGRESS';\n\nlet initialState = {\n    users: [],\n    pageSize: 100,\n    totalUserCount: 0,\n    currentPage: 4,\n    isFetching: true,\n    followingInProgress: [2, 1]\n};\nconst UsersReducer = (state = initialState, action) => {\n    switch (action.type) {\n        case FOLLOW: {\n\n            return {\n                ...state,\n                users: updateObjectInArray(state.users, action.userId, \"id\", { followed: true })\n\n            }\n        }\n        case UNFOLLOW: {\n            return {\n                ...state,\n                users: updateObjectInArray(state.users, action.userId, \"id\", { followed: false })\n            }\n\n        }\n        case SET_USERS: {\n            return { ...state, users: action.users }\n        }\n        case SET_CURRENT_PAGE: {\n            return { ...state, currentPage: action.currentPage }\n        }\n        case SET_TOTAL_USERS_COUNT: {\n            return { ...state, totalUserCount: action.totalUsersCount }\n        }\n        case TOGGLE_IS_FETHING: {\n            return { ...state, isFetching: action.isFetching }\n        }\n        case TOGGLE_IS_FOLLOWING_PROGRESS: {\n            return {\n                ...state,\n                followingInProgress: action.isFetching\n                    ? [...state.followingInProgress, action.userId]\n                    : state.followingInProgress.filter(id => id != action.userId)\n            }\n        }\n        default:\n            return state;\n    }\n\n}\n\nexport const followSuccess = (userId) => (\n\n    { type: FOLLOW, userId }\n\n)\nexport const unfollowSuccess = (userId) => {\n\n    return { type: UNFOLLOW, userId }\n}\nexport const setUsers = (users) => ({ type: SET_USERS, users })\nexport const setCurrentPage = (currentPage) => ({ type: SET_CURRENT_PAGE, currentPage })\nexport const setTotalUsersCount = (totalUsersCount) => ({ type: SET_TOTAL_USERS_COUNT, totalUsersCount })\nexport const toggleIsFetching = (isFetching) => ({ type: TOGGLE_IS_FETHING, isFetching })\nexport const toggleFollowingProgress = (isFetching, userId) => ({ type: TOGGLE_IS_FOLLOWING_PROGRESS, isFetching, userId })\n\nexport const requestUsers = (currentPage, pageSize) => {\n\n    return async (dispatch) => {\n        dispatch(toggleIsFetching(true));\n\n        let data = await usersAPI.getUsers(currentPage, pageSize)\n        dispatch(toggleIsFetching(false));\n        dispatch(setUsers(data.items));\n        dispatch(setTotalUsersCount(data.totalCount));\n\n\n    }\n\n}\n\n\nconst followUnfollowFlow = async (dispatch, userId, apiMethod, actionCreator) => {\n    dispatch(toggleFollowingProgress(true, userId));\n    let response = await apiMethod(userId)\n    if (response.data.resultCode === 0) {\n        dispatch(followSuccess(userId))\n    }\n    dispatch(toggleFollowingProgress(false, userId));\n}\n\n\nexport const follow = (userId) => async (dispatch) => {\n    let apiMethod = usersAPI.follow.bind(usersAPI);\n    followUnfollowFlow(dispatch, userId, apiMethod, followSuccess)\n\n}\n\n\nexport const unfollow = (userId) => async (dispatch) => {\n    let apiMethod = usersAPI.unfollow.bind(usersAPI);\n    followUnfollowFlow(dispatch, userId, apiMethod, unfollowSuccess)\n\n}\nexport default UsersReducer;"]},"metadata":{},"sourceType":"module"}